var ngPopup=angular.module("ngPopup",[]);ngPopup.factory("ngPopupBuilder",["$q","$http","$document","$log","$compile",function(e,t,n,i,o){var l=!1,s=0,p=0,a={layoutInitAsync:function(n){var o=n.template?n.template:"",l=e.defer(),s='<div class="container"><div class="resizeCorner"><div class="left-top-corner"></div><div class="left-bottom-corner"></div><div class="right-top-corner"></div><div class="right-bottom-corner"></div></div><div class="resizeBar"><div class="top-bar"></div><div class="right-bar"></div><div class="bottom-bar"></div><div class="left-bar"></div></div><div class="titleBar" ng-show="option.hasTitleBar"><span class="title">{{option.title}}</span><div class="iconGroup"><span class="glyphicon glyphicon-minus" ng-click="action.minimize(option.isMinimized)" id="minBtn"></span><span class="glyphicon glyphicon-resize-full" ng-click="action.maximize(option.isMaximized)" id="maxBtn"></span><span class="glyphicon glyphicon-pushpin" ng-click="action.togglePin($event)" id="pinBtn"></span><span class="glyphicon glyphicon-remove" ng-click="action.close($event)" id="closeBtn"></span></div></div><div class="content" ng-class="{contentNoBar:!option.hasTitleBar}">';return n.templateUrl?t.get(n.templateUrl).then(function(e){s+=o+e.data+"</div></div>",l.resolve(s)},function(e){i.error(e),l.reject(e)}):(s+=o+"</div></div>",l.resolve(s)),l.promise},getDefaultMethods:function(e,t){var n=t[0],i={open:function(t){null!=t&&(n.style.top=t.top+"px",n.style.left=t.left+"px",e.position.top=t.top,e.position.left=t.left),e.onOpen&&e.onOpen(),e.isShow=!0},close:function(t){e.onClose&&e.onClose(),e.isShow=!1,l=!0},maximize:function(t){t?(n.style.height=s+"px",n.style.width=p+"px",e.width=n.offsetWidth,e.height=n.offsetHeight,angular.element(document.querySelector("#maxBtn")).removeClass("glyphicon-resize-small").addClass("glyphicon-resize-full")):(s=n.offsetHeight,p=n.offsetWidth,n.getElementsByClassName("content")[0].style.display="block",n.style.top="5px",n.style.left="5px",n.style.width="calc( 100vw - 10px )",n.style.height="calc( 100vh - 10px )",e.position.top=n.offsetTop,e.position.left=n.offsetLeft,e.width=n.offsetWidth,e.height=n.offsetHeight,angular.element(document.querySelector("#maxBtn")).removeClass("glyphicon-resize-full").addClass("glyphicon-resize-small")),e.isMaximized=!e.isMaximized,l=!0},minimize:function(t){t?(n.style.height=e.height+"px",n.style.width=e.width+"px",n.style.top=e.position.top+"px",n.style.left=e.position.left+"px",n.getElementsByClassName("content")[0].style.display="block",angular.element(document.querySelector("#minBtn")).removeClass("glyphicon-plus").addClass("glyphicon-minus"),e.position.top=n.offsetTop,e.position.left=n.offsetLeft):(n.getElementsByClassName("content")[0].style.display="none",n.style.height=n.getElementsByClassName("titleBar")[0].style.height,n.style.width="200px",angular.element(document.querySelector("#minBtn")).removeClass("glyphicon-minus").addClass("glyphicon-plus")),e.isMinimized=!e.isMinimized,l=!0},togglePin:function(){1!=e.pinned?(document.querySelector("#pinBtn").style.color="#EB5342",e.pinned=!0):(document.querySelector("#pinBtn").style.color="",e.pinned=!1),l=!0},isMaximized:function(){return e.isMaximized},isMinimized:function(){return e.isMinimized}};return i},getDefaultOptions:function(e){return e?(e.modelName=e.modelName||"ngPopup",e.width=e.width||100,e.height=e.height||100,e.template=e.template||"<div>No content assigned, <br><a href='https://github.com/MarkoCen/ngPopup/wiki/API-:-Options'>ngPopup API Options</a></div>",e.templateUrl=e.templateUrl||null,e.resizable=null==e.resizable?!0:e.resizable,e.draggable=null==e.draggable?!0:e.draggable,e.position=e.position||{top:0,left:0},e.title=e.title||"Welcome to ngPopup!",e.hasTitleBar=null==e.hasTitleBar?!0:e.hasTitleBar,e.pinned=null==e.pinned?!1:e.pinned,e.isShow=null==e.isShow?!0:e.isShow,e.isMinimized=null==e.isMinimized?!1:e.isMinimized,e.isMaximized=null==e.isMaximized?!1:e.isMaximized,e.onOpen=e.onOpen||function(){},e.onClose=e.onClose||function(){},e.onDragStart=e.onDragStart||function(){},e.onDragEnd=e.onDragEnd||function(){},e.onResize=e.onResize||function(){},e):{modelName:"myDialog",width:100,height:100,template:"<div>No content assigned, <br><a href='https://github.com/MarkoCen/ngPopup/wiki/API-:-Options'>ngPopup API Options</a></div>",templateUrl:null,resizable:!0,draggable:!0,position:{top:0,left:0},title:"Welcome to ngPopup!",hasTitleBar:!0,pinned:!1,isShow:!0,onOpen:function(){},onClose:function(){},onDragStart:function(){},onDragEnd:function(){},onResize:function(){}}},callParentScopeApply:function(e){e.$$phase||e.$digest()},updateParentScopeOptions:function(e,t){var n=t[0];e.position.top=n.offsetTop,e.position.left=n.offsetLeft,"none"!=n.getElementsByClassName("content")[0].style.display&&(e.width=n.offsetWidth,e.height=n.offsetHeight)},updateElementSize:function(e,t,n){var i=e[0];"string"==typeof t&&(i.style.width="%"==t.slice(-1)?t:parseInt(t,10)+"px"),"number"==typeof t&&(i.style.width=t+"px"),"string"==typeof n&&(i.style.height="%"==n.slice(-1)?n:parseInt(n,10)+"px"),"number"==typeof n&&(i.style.height=n+"px")},updateElementPosition:function(e,t){var n=e[0];"string"==typeof t.top&&(n.style.top=t.top),"number"==typeof t.top&&(n.style.top=t.top+"px"),"string"==typeof t.left&&(n.style.left=t.left),"number"==typeof t.left&&(n.style.left=t.left+"px")},updateBindingValue:function(e,t,n){var i=n.scope,o=n.element,s=(n.attrs,o[0]);s.style.position=e.pinned?"fixed":"absolute",i.option.isMinimized||a.updateElementSize(o,e.width,e.height),(e.position.top!=t.position.top||e.position.left!=e.position.left)&&(s.style.top=e.position.top+"px",s.style.left=e.position.left+"px"),e.isShow==t.isShow||l||(e.isShow?e.onOpen&&e.onOpen():e.onClose&&e.onClose()),(e.width!=t.width||e.height!=t.height)&&e.onResize&&e.onResize(),e.hasTitleBar!=t.hasTitleBar&&(i.option.hasTitleBar=e.hasTitleBar),l=!1}};return a}]),ngPopup.directive("ngPopUp",["$parse","$document","$templateCache","$compile","ngPopupBuilder",function(e,t,n,i,o){return{restrict:"EA",scope:{option:"=?"},replace:!0,template:'<div class="ngPopup" ng-show="option.isShow"></div>',link:function(e,n,l){var s=n[0],p=o.getDefaultOptions(e.option),a=(p.modelName,!1),r=!1,d=!1,c={scope:e,element:n,attrs:l};o.layoutInitAsync(p).then(function(t){var l=i(t)(e);n.append(l),o.updateBindingValue(p,o.getDefaultOptions(),c),d=!0}),e.$watch("option",function(e,t){d&&o.updateBindingValue(e,t,c)},!0),e.action=o.getDefaultMethods(p,n),n.bind("mousedown",function(i){var l=angular.element(i.target),d=parseFloat(window.getComputedStyle(s,null).top),c=parseFloat(window.getComputedStyle(s,null).left),u=parseFloat(window.getComputedStyle(s,null).height),g=parseFloat(window.getComputedStyle(s,null).width),h=i.pageY,f=i.pageX;if(l.hasClass("titleBar")||l.hasClass("title")||l.parent().hasClass("contentNoBar")||l.hasClass("contentNoBar")){if(0==p.draggable)return;p.onDragStart&&(p.onDragStart(),a=!0),t.find("body").addClass("unselectable"),t.bind("mousemove",function(t){s.style.top=t.pageY-h+d+"px",s.style.left=t.pageX-f+c+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)})}if(l.parent().hasClass("resizeCorner")){if(0==p.resizable)return void t.find("body").removeClass("unselectable");p.onResize&&(p.onResize(),r=!0),t.find("body").addClass("unselectable"),l.hasClass("right-bottom-corner")?t.bind("mousemove",function(t){s.style.height=u+t.pageY-h+"px",s.style.width=g+t.pageX-f+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)}):l.hasClass("right-top-corner")?t.bind("mousemove",function(t){s.style.top=t.pageY+"px",s.style.width=g+t.pageX-f+"px",s.style.height=u-t.pageY+h+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)}):l.hasClass("left-top-corner")?t.bind("mousemove",function(t){s.style.left=c+t.pageX-f+"px",s.style.top=t.pageY+"px",s.style.width=g-t.pageX+f+"px",s.style.height=u-t.pageY+h+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)}):l.hasClass("left-bottom-corner")&&t.bind("mousemove",function(t){s.style.left=t.pageX+"px",s.style.width=g-t.pageX+f+"px",s.style.height=u+t.pageY-h+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)})}if(l.parent().hasClass("resizeBar")){if(0==p.resizable)return void t.find("body").removeClass("unselectable");p.onResize&&(p.onResize(),r=!0),t.find("body").addClass("unselectable"),l.hasClass("left-bar")?t.bind("mousemove",function(t){s.style.left=c+t.pageX-f+"px",s.style.width=g-t.pageX+f+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)}):l.hasClass("right-bar")?t.bind("mousemove",function(t){s.style.width=g+t.pageX-f+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)}):l.hasClass("top-bar")?t.bind("mousemove",function(t){s.style.top=t.pageY+"px",s.style.height=u-t.pageY+h+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)}):l.hasClass("bottom-bar")&&t.bind("mousemove",function(t){s.style.height=u+t.pageY-h+"px",o.updateParentScopeOptions(e.option,n),o.callParentScopeApply(e.$parent)})}o.callParentScopeApply(e.$parent)}),n.bind("mouseup",function(n){p.onDragEnd&&a&&(p.onDragEnd(),a=!1,r=!1),t.find("body").removeClass("unselectable"),t.unbind("mousemove"),o.callParentScopeApply(e.$parent)})}}}]);